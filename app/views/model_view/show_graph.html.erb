<!DOCTYPE html>
<html lang="en">
<head>
  <title>Bootstrap Example</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
  <body>
    <div>
      <h1>Graph</h1>
      <script src="http://code.highcharts.com/highcharts.js"></script>
      <script src="http://code.highcharts.com/modules/exporting.js"></script>

<!-- Trigger the modal with a button -->
      <button type="button" class="btn btn-info btn-lg" id="showModal" >Settings</button>

      <button id="budget" type="button" class="autocompare">Budget</button>
      <button id="tp" class="autocompare">TP</button>
      <button id="poverty" class="autocompare">Poverty</button>

      <button id="goods2011" class="autocompare">Public_goods_2011</button>
      <button id="goods" class="autocompare">Public_goods</button>

<!-- Modal -->
    <div id="myModal" class="modal fade" role="dialog">
      <div class="modal-dialog modal-lg">

    <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Modal Header</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="page" id="1">
          <div class="dropdown">
  <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Dropdown button
  </button>
  <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
    <a class="dropdown-item" href="#">Action</a>
    <a class="dropdown-item" href="#">Another action</a>
    <a class="dropdown-item" href="#">Something else here</a>
  </div>
</div>
</br>
<div class="dropdown">
<button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
Dropdown button
</button>
<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
<a class="dropdown-item" href="#">Action</a>
<a class="dropdown-item" href="#">Another action</a>
<a class="dropdown-item" href="#">Something else here</a>
</div>
</div>
</br>
<div class="dropdown">
<button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
Dropdown button
</button>
<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
<a class="dropdown-item" href="#">Action</a>
<a class="dropdown-item" href="#">Another action</a>
<a class="dropdown-item" href="#">Something else here</a>
</div>
</div>
          <div class="form-group">
            <div class="checkbox">
   <label><input type="checkbox" value="" >Option 1</label>
 </div>
 <div class="checkbox">
   <label><input type="checkbox" value="" >Option 2</label>
 </div>
 <div class="checkbox disabled">
   <label><input type="checkbox" value="" >Option 3</label>
 </div>

 <form>
  <div class="form-group">
    <label for="email">Agriculture budget (integer):</label>
    <input type="email" class="form-control" id="input_agro">
  </div>
  <div class="form-group">
    <label for="email">Non Agriculture budget (integer):</label>
    <input type="email" class="form-control" id="input_non">
  </div>
 </form>
         </div>
       </div>
       <div class="page" id="2"  style="display:none;">
       <div class="dropdown">
<button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
 Dropdown 2.1
</button>
<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
 <a class="dropdown-item" href="#">Action</a>
 <a class="dropdown-item" href="#">Another action</a>
 <a class="dropdown-item" href="#">Something else here</a>
</div>
</div>
</br>
<div class="dropdown">
<button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
Dropdown 2.2
</button>
<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
<a class="dropdown-item" href="#">Action</a>
<a class="dropdown-item" href="#">Another action</a>
<a class="dropdown-item" href="#">Something else here</a>
</div>
</div>
</br>
<div class="dropdown">
<button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
Dropdown 2.3
</button>
<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
<a class="dropdown-item" href="#">Action</a>
<a class="dropdown-item" href="#">Another action</a>
<a class="dropdown-item" href="#">Something else here</a>
</div>
</div>
       <div class="form-group">
         <div class="checkbox">
<label><input type="checkbox" value="" >2Option 1</label>
</div>
<div class="checkbox">
<label><input type="checkbox" value="" >2Option 2</label>
</div>
<div class="checkbox disabled">
<label><input type="checkbox" value="" >2Option 3</label>
</div>

<form>
<div class="form-group">
 <label for="email">Title:</label>
 <input type="email" class="form-control" id="text_input_1">
</div>
<div class="form-group">
 <label for="email">Subtitle:</label>
 <input type="email" class="form-control" id="text_input_2">
</div>
</form>
      </div>
    </div>
    <div class="page" id="3" style="display:none;">
    <div class="dropdown">
<button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
Dropdown 3.1
</button>
<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
<a class="dropdown-item" href="#">Action</a>
<a class="dropdown-item" href="#">Another action</a>
<a class="dropdown-item" href="#">Something else here</a>
</div>
</div>
</br>
<div class="dropdown">
<button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
Dropdown 3.2
</button>
<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
<a class="dropdown-item" href="#">Action</a>
<a class="dropdown-item" href="#">Another action</a>
<a class="dropdown-item" href="#">Something else here</a>
</div>
</div>
</br>
<div class="dropdown">
<button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
Dropdown 3.3
</button>
<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
<a class="dropdown-item" href="#">Action</a>
<a class="dropdown-item" href="#">Another action</a>
<a class="dropdown-item" href="#">Something else here</a>
</div>
</div>
    <div class="form-group">
      <div class="checkbox">
<label><input type="checkbox" value="" >3Option 1</label>
</div>
<div class="checkbox">
<label><input type="checkbox" value="" >3Option 2</label>
</div>
<div class="checkbox disabled">
<label><input type="checkbox" value="" >3Option 3</label>
</div>

<form>
<div class="form-group">
<label for="email">Title:</label>
<input type="email" class="form-control" id="text_input_1">
</div>
<div class="form-group">
<label for="email">Subtitle:</label>
<input type="email" class="form-control" id="text_input_2">
</div>
</form>
   </div>
 </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" id="confirm">Confirm</button>
        </div>

    <nav aria-label="pagination example" class="transparent-style">
      <ul class="pagination pagination-circle pg-blue mb-0">

        <li class="page-item active" id="1">
            <a class="page-link" href="#">
              1
              <span class="sr-only">(current)</span>
            </a>
        </li>
        <li class="page-item"  id="2"><a class="page-link" href="#">2</a></li>
        <li class="page-item"  id="3"><a class="page-link" href="#">3</a></li>
      </ul>
    </nav>
      </div>
    </div>
  </div>
  <div id="container1" remote="true" style="min-width: 310px; height: 400px; margin: 0 auto"></div>

<script>
var tabsChosen = 1;

$(function() {
  var currentPage = 1;
  var pageNumbers = [];
  var chartType = "pie";

  $('#showModal').on("click", function(event) {
      $('.modal').modal('show');
      modalIsShowing = true;
    $('.page-item').each(function(event) {
      var itemId = $(this).attr('id');
      if (itemId == '1') {
        $('#' + itemId + '.page-item').addClass('active');
        $("div[id='" + itemId + "']").show();
      } else {
        $('#' + itemId + '.page-item').removeClass('active');
        $("div[id='" + itemId + "']").hide();
      }
      pageNumbers.push(itemId);
    });
  });

  $('.page-item').on("click", function(event) {
     var previousPage = currentPage;
     var elementToHide = $("div[id='" + previousPage + "']");
     currentPage = $(this).attr('id');
     var elementToShow = $("div[id='" + currentPage + "']")
     $('#' + previousPage + '.page-item').removeClass('active');
     $('#' + currentPage + '.page-item').addClass('active');
     elementToHide.hide();
     elementToShow.show();
  });

  var series = [
    <% @graph.series.each { |serie| %>
      {
      name: '<%= serie[:name] %>',
      data: <%= raw @graph.series[0][:data_array] %>
      //data: '<%#= raw dataValue %>'
      }
  <%  } %>
  ];

  var chartOptions = {
    chart: { // renderTo: "pie_chart"
    type: "<%= @graph.type %>" },
    title: { text: "<%= @graph.title %>" },
    xAxis: { type: "<%= @graph.x_opts[:type] %>", categories: "<%= @graph.x_opts[:categories] %>" },
    yAxis: { title: { text: "<%= @graph.y_opts[:title] %>" } }
 };

 window.updateChart = function(series) {
  <% puts "update function called" %>
  tabsChosen = 1;
  chartType = "column";
  var title = "effective budget";
  chartOptions.chart.type = chartType;
  chartOptions.title = title;
  updateChartWithValues(in_budget_agriculture, in_budget_non_agriculture);
};

$('#budget').click(function () {
  //balken
    <% puts "budget clicked" %>
    tabsChosen = 1;
    chartType = "column";
    var title = "effective budget";
    chartOptions.chart.type = chartType;
    chartOptions.title = title;
    updateChartWithValues(in_budget_agriculture, in_budget_non_agriculture);
});

$('#tp').click(function () {
  //balken
    tabsChosen = 2;
    chartType = "column";
    var title = "technical progress";
    chartOptions.chart.type = chartType;
    chartOptions.title = title;
    updateChartWithValues(in_budget_agriculture, in_budget_non_agriculture);
});

$('#goods2011').click(function () {
  //balken
    tabsChosen = 3;
    chartType = "column";
    var title = "Goods of 2001";
    chartOptions.chart.type = chartType;
    chartOptions.title = title;
    updateChartWithValues(in_budget_agriculture, in_budget_non_agriculture);
});

$('#goods').click(function () {
  //linie
    tabsChosen = 4;
    chartType = "line";
    var title = "Public goods over years";
    var yTitle = "years";
    chartOptions.chart.type = chartType;
    chartOptions.title = title;
    chartOptions.xAxis.categories = years;
    updateChartWithValues(in_budget_agriculture, in_budget_non_agriculture);
});

$('#poverty').click(function () {
  //linie
    tabsChosen = 5;
    chartType = "line";
    var title = "Goal achievement poverty";
    var yTitle = "years";
    chartOptions.chart.type = chartType;
    chartOptions.title = title;
    chartOptions.xAxis.categories = years;
    updateChartWithValues(in_budget_agriculture, in_budget_non_agriculture);
});

var tabChosen = 1;
var in_budget_agriculture = 25;
var in_budget_non_agriculture = 15;

var p_rho = 0.5;
var p_mu1 = 0.7;
var p_mu2 = 0.3;
var p_emax = 10;
var p_a = 1;
var p_b = -15;

var yearStart = 2009;
var yearEnd = 2021;

var years = (function() {
  var years_array = [];
  while(yearStart < yearEnd + 1) {
    years_array.push(yearStart++);
  }
  return years_array;
})();

function output_effective_budget() {
  var firstSum = p_mu1 * Math.pow(in_budget_agriculture, -p_rho);
  var secondSum = p_mu2 * Math.pow(in_budget_non_agriculture,-p_rho);
  var result = Math.pow((firstSum + secondSum), (-1 / p_rho));
  return result;
};

function output_tp() {
  var firstExp = p_a * output_effective_budget() + p_b;
  var secondExp = p_a * output_effective_budget() + p_b;
  return p_emax * (Math.exp(firstExp)) / (1 + Math.exp(secondExp));
};

function output_goal_achievement_poverty() {
  var output_array = [];
  for(i = 0; i < years.length; i++) {
    var valueToPush = 100 - output_tp() * 0.1 * (years[i] - 1);
    output_array.push(valueToPush);
  }
  return output_array;
};

function output_goal_achivement_public_goods() {
//  window.alert("argf: " + in_budget_agriculture + "; nonf: " + in_budget_non_agriculture);
  var result = 100 - (in_budget_agriculture + in_budget_non_agriculture);
//  window.alert("result: " + result);
  return 100 - (in_budget_agriculture + in_budget_non_agriculture);
};

function output_goal_achivement_public_goods_years() {
  var output_array = [];
  for(i = 1; i < years.length; i++) {
    output_array.push(100 - (in_budget_agriculture + in_budget_non_agriculture) + output_tp() * 0.8 * (years[i] - 1));
  }
  return output_array;
};

window.updateChartWithValues = function(in_budget_agriculture, in_budget_non_agriculture) {
    //set series
    switch(tabsChosen) {
    case 1:
      var seriesData = [output_effective_budget()];
    //  window.alert("series data1: " + seriesData);
      <% puts "in case 1" %>
      chartOptions.series = [{
          name: "Budget distribution over years",
          data: seriesData
      }];
      break;
    case 2:
      <% puts "in case 2" %>
      var seriesData = [output_tp()];
  //    window.alert("series data2: " + seriesData);
      chartOptions.series = [{
          name: "TP",
          data: seriesData
        }];
          break;
    case 3:
      <% puts "in case 3" %>
  //    window.alert("agri: "+ in_budget_agriculture +"; non: " + in_budget_non_agriculture);
      var seriesData = [output_goal_achivement_public_goods()];
  //    window.alert("series data3: " + seriesData);
      chartOptions.series = [{
          name: "Goods of year 2001",
          data: seriesData
      }];
        break;
    case 4:
      <% puts "in case 4" %>
      var seriesData = output_goal_achivement_public_goods_years();
  //    window.alert("series data4: " + seriesData);
      chartOptions.series = [{
          name: "Public goods over years",
          data: seriesData
      }];
        break;
    case 5:
      <% puts "in case 5" %>
      var seriesData = output_goal_achievement_poverty();
  //    window.alert("series data5: " + seriesData);
      chartOptions.series = [{
          name: "Goal achievement poverty",
          data: seriesData
      }];
        break;
    default:
      <% puts "in case default" %>
  }

    Highcharts.chart('container1', chartOptions);
};

updateChart(series);

/*
  var chart = $('#container1').highcharts({
     chart: {
      // renderTo: "pie_chart"
       type: "<%= @graph.type %>"
       },
       title: { text: "<%= @graph.title %>" },
       xAxis: { type: "<%= @graph.x_opts[:type] %>"},
       yAxis: {
       title: { text: "<%= @graph.y_opts[:title] %>" }
    },
    series: [
      <%# @graph.series.each { |serie| %>
        {
        name: '<%#= serie[:name] %>',
        data: graphData
        //data: '<%#= raw dataValue %>'
        }
    <%#  } %>
        ]
      }); */

      $('#confirm').on("click", function(event) {
        var id = $(this).attr('id');
        if (pageNumbers.length > 0) {

          var intValueOfPage = parseInt(currentPage);
          if (intValueOfPage > 0 && intValueOfPage == pageNumbers.length) {
            //exit, save, change graph
            var agro = document.getElementById('input_agro').value;
            //  window.alert("agro found: " + agro);
            if (parseInt(agro)) {
          //    window.alert("agro was set: " + agro);
              agro = parseInt(agro);
            } else {
          //    window.alert("agro was set to 0" );
              agro = 0;
            }

            var non = document.getElementById('input_non').value;
          //  window.alert("non found: " + non);
            if (parseInt(non)) {
        //      window.alert("agro was set: " + non);
              non = parseInt(non);
            } else {
        //      window.alert("agro was set to 0" );
              non = 0;
            }

        //    window.alert("before update agro: " + agro + "; non: " + non);
            in_budget_agriculture = agro;
            in_budget_non_agriculture = non;
            updateChartWithValues(in_budget_agriculture, in_budget_non_agriculture);

            $('.modal.in').modal('toggle');
            currentPage = 1;
            pageNumbers = [];
          } else if (intValueOfPage > 0 && intValueOfPage < pageNumbers.length) {
            var previousPage = currentPage;
            var elementToHide = $("div[id='" + previousPage + "']");
            currentPage = (intValueOfPage + 1).toString();
            var elementToShow = $("div[id='" + currentPage + "']");
            $('#' + previousPage + '.page-item').removeClass('active');
            $('#' + currentPage + '.page-item').addClass('active');
            elementToHide.hide();
            elementToShow.show();
          }
        }
      });
   });

 </script>
    </div>
  </body>
</html>
